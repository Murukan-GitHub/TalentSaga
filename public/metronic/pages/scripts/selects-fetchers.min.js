var SelectsFetchers=function(){var t=function(){var t=$(".select2");if(t.length){var e=$("[data-child]");e.length&&$.each(e,function(){var t=$(this),e=t.data("child")||!1,n=t.data("url")||!1;e&&n&&(e.indexOf("#")?elmtChild=$("#"+e):elmtChild=$(e),t.on("change",function(t){t.preventDefault(),SelectsFetchers.initChildJsonMultiselect($(this),elmtChild,n)}),SelectsFetchers.initChildJsonMultiselect(t,elmtChild,n))})}},e=function(){var t=$(".select2");if(t.length){var e=$("[data-childs]");e.length&&$.each(e,function(){var t=$(this),e=t.data("childs")||!1,n=t.data("url")||!1;if(e&&n){var a=e.split(","),c=[];if(a.length>0)for(i=0;i<a.length;i++)a.indexOf("#")?c.push($("#"+a[i])):c.push($(a[i]));t.on("change",function(t){t.preventDefault(),SelectsFetchers.initChildsJsonMultiselects($(this),c,n)}),SelectsFetchers.initChildsJsonMultiselects(t,c,n)}})}};return{init:function(){t(),e()},initChildJsonMultiselect:function(t,e,n){var i=e.attr("id"),a="#ms-"+i,c=[];t.children("option:selected").each(function(){c.push($(this).val())});var l=!1;return $.ajax({type:"GET",async:!0,url:n+"?nocache="+Math.random(),data:{id:c},cache:!1,beforeSend:function(){App.blockUI({target:a,animate:!0})},complete:function(){App.unblockUI(a)},success:function(t){var n=t,i=[],a=[];$.each(n,function(t,n){var c=$(e).val()||!1,l=$(e).data("value")||[],r=c||l;r.length>0&&$.each(r,function(t){a.push(r[t])}),$(e).empty();var o=n.data;if(o.length>0){var d=$("<optgroup />");d.attr("id","group-"+$(e).attr("id")+"-"+n.id),d.attr("label",n.name),$.each(o,function(t,e){if(a.length>0&&(a.indexOf(e.id.toString())>-1||a.indexOf(e.id)>-1)){var n=$("<option selected='selected'></option>");n.val(e.id),n.text(e.name),d.append(n)}else{var n=$("<option></option>");n.val(e.id),n.text(e.name),d.append(n)}});var u={id:$(e).attr("id"),group:d};i.push(u)}}),$.each(i,function(t){$(e).append(i[t].group)}),$(e).multiSelect("refresh")}}),l},initChildsJsonMultiselects:function(t,e,n){var i=[];t.children("option:selected").each(function(){i.push($(this).val())});var a=!1;return $.ajax({type:"GET",async:!0,url:n+"?nocache="+Math.random(),data:{id:i},cache:!1,beforeSend:function(){$.each(e,function(t,e){var n="#ms-"+e.attr("id");App.blockUI({target:n,animate:!0})})},complete:function(){$.each(e,function(t,e){var n="#ms-"+e.attr("id");App.unblockUI(n)})},success:function(t){a=t;var n=[],i=[];$.each(t,function(t,a){$.each(e,function(t,e){var c=$(e).val()||!1,l=$(e).data("value")||[],r=c||l;r.length>0&&$.each(r,function(t){i.push({id:$(e).attr("id"),selected:r[t]})}),$(e).empty();var o=$(e).data("objects");if(o){var d=a[o];if(d.length>0){var u=$("<optgroup />");u.attr("id","group-"+$(e).attr("id")+"-"+a.id),u.attr("label",a.name),$.each(d,function(t,n){if(i.length>0){var a=i.filter(function(t){return t.id===$(e).attr("id")}),c=a.map(function(t){return t.selected}).indexOf(n.id),l=a.map(function(t){return t.selected}).indexOf(n.id.toString());if(c>-1||l>-1){var r=$("<option selected='selected'></option>");r.val(n.id),r.text(n.name),u.append(r)}else{var r=$("<option></option>");r.val(n.id),r.text(n.name),u.append(r)}}else{var r=$("<option></option>");r.val(n.id),r.text(n.name),u.append(r)}});var s={id:$(e).attr("id"),group:u};n.push(s)}}})}),$.each(e,function(t,e){$.each(n,function(t){n[t].id==$(e).attr("id")&&$(e).append(n[t].group)}),$(e).multiSelect("refresh")})}}),a}}}();jQuery(document).ready(function(){SelectsFetchers.init()});